{"remainingRequest":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\babel-loader\\lib\\index.js!E:\\WebStormProject\\blog-vue-typescript\\node_modules\\ts-loader\\index.js??ref--13-2!E:\\WebStormProject\\blog-vue-typescript\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!E:\\WebStormProject\\blog-vue-typescript\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\WebStormProject\\blog-vue-typescript\\src\\views\\articles.vue?vue&type=script&lang=ts&","dependencies":[{"path":"E:\\WebStormProject\\blog-vue-typescript\\src\\views\\articles.vue","mtime":1572859521995},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\ts-loader\\index.js","mtime":1545640398000},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _toConsumableArray from \"E:\\\\WebStormProject\\\\blog-vue-typescript\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"E:\\\\WebStormProject\\\\blog-vue-typescript\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"E:\\\\WebStormProject\\\\blog-vue-typescript\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"E:\\\\WebStormProject\\\\blog-vue-typescript\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"E:\\\\WebStormProject\\\\blog-vue-typescript\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"E:\\\\WebStormProject\\\\blog-vue-typescript\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _inherits from \"E:\\\\WebStormProject\\\\blog-vue-typescript\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/inherits\";\nimport * as tslib_1 from \"tslib\";\nimport { Component, Vue, Watch } from \"vue-property-decorator\";\nimport { throttle, getScrollTop, getDocumentHeight, getWindowHeight, getQueryStringByName } from \"@/utils/utils\";\nimport LoadEnd from \"@/components/loadEnd.vue\";\nimport LoadingCustom from \"@/components/loading.vue\"; // 获取可视区域的高度\n\nvar viewHeight = window.innerHeight || document.documentElement.clientHeight; // 用新的 throttle 包装 scroll 的回调\n\nvar lazyload = throttle(function () {\n  // 获取所有的图片标签\n  var imgs = document.querySelectorAll(\"#list .item img\"); // num 用于统计当前显示到了哪一张图片，避免每次都从第一张图片开始检查是否露出\n\n  var num = 0;\n\n  for (var i = num; i < imgs.length; i++) {\n    // 用可视区域高度减去元素顶部距离可视区域顶部的高度\n    var distance = viewHeight - imgs[i].getBoundingClientRect().top;\n    var imgItem = imgs[i]; // 如果可视区域高度大于等于元素顶部距离可视区域顶部的高度，说明元素露出\n\n    if (distance >= 100) {\n      // 给元素写入真实的 src，展示图片\n      var hasLaySrc = imgItem.getAttribute(\"data-has-lazy-src\");\n\n      if (hasLaySrc === \"false\") {\n        imgItem.src = imgItem.getAttribute(\"data-src\");\n        imgItem.setAttribute(\"data-has-lazy-src\", \"true\");\n      } // 前 i 张图片已经加载完毕，下次从第 i+1 张开始检查是否露出\n\n\n      num = i + 1;\n    }\n  }\n}, 1000);\n\nvar Articles =\n/*#__PURE__*/\nfunction (_Vue) {\n  _inherits(Articles, _Vue);\n\n  function Articles() {\n    var _this;\n\n    _classCallCheck(this, Articles);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Articles).apply(this, arguments)); // initial data\n\n    _this.isLoadEnd = false;\n    _this.isLoading = false;\n    _this.articlesList = [];\n    _this.total = 0;\n    _this.tag_name = decodeURI(getQueryStringByName(\"tag_name\"));\n    _this.params = {\n      keyword: \"\",\n      likes: \"\",\n      state: 1,\n      tag_id: getQueryStringByName(\"tag_id\"),\n      category_id: getQueryStringByName(\"category_id\"),\n      pageNum: 1,\n      pageSize: 10\n    };\n    _this.href = process.env.NODE_ENV === \"development\" ? \"http://localhost:3001/articleDetail?article_id=\" : \"https://biaochenxuying.cn/articleDetail?article_id=\";\n    return _this;\n  } // lifecycle hook\n\n\n  _createClass(Articles, [{\n    key: \"mounted\",\n    value: function mounted() {\n      var _this2 = this;\n\n      this.handleSearch();\n\n      window.onscroll = function () {\n        if (getScrollTop() + getWindowHeight() > getDocumentHeight() - 150) {\n          // 如果不是已经没有数据了，都可以继续滚动加载\n          if (_this2.isLoadEnd === false && _this2.isLoading === false) {\n            _this2.handleSearch();\n          }\n        }\n      };\n\n      document.addEventListener(\"scroll\", lazyload);\n    }\n  }, {\n    key: \"routeChange\",\n    value: function routeChange(val, oldVal) {\n      this.tag_name = decodeURI(getQueryStringByName(\"tag_name\"));\n      this.params.tag_id = getQueryStringByName(\"tag_id\");\n      this.params.category_id = getQueryStringByName(\"category_id\");\n      this.articlesList = [];\n      this.params.pageNum = 1;\n      this.handleSearch();\n    } // method\n\n  }, {\n    key: \"articleDetail\",\n    value: function articleDetail(id) {// console.log(\"`id`\", `/articleDetail?article_id=${id}`);\n      // let url: string = \"\";\n      // if (process.env.NODE_ENV === \"development\") {\n      //   url = \"http://localhost:3001/articleDetail?\";\n      // } else {\n      //   url = \"https://biaochenxuying.cn/articleDetail?\";\n      // }\n      // window.open(url + `article_id=${id}`);\n    }\n  }, {\n    key: \"handleSearch\",\n    value: function () {\n      var _handleSearch = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee() {\n        var data;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                this.isLoading = true;\n                _context.next = 3;\n                return this.$https.get( //this.$urls.getArticleList,\n                '/articleList.json', {\n                  params: this.params\n                });\n\n              case 3:\n                data = _context.sent;\n                this.isLoading = false;\n                this.articlesList = [].concat(_toConsumableArray(this.articlesList), _toConsumableArray(data.list));\n                this.total = data.count;\n                this.params.pageNum++;\n                this.$nextTick(function () {\n                  lazyload();\n                });\n\n                if (data.list.length === 0 || this.total === this.articlesList.length) {\n                  this.isLoadEnd = true;\n                  document.removeEventListener(\"scroll\", function () {});\n                  window.onscroll = null;\n                }\n\n              case 10:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function handleSearch() {\n        return _handleSearch.apply(this, arguments);\n      }\n\n      return handleSearch;\n    }()\n  }]);\n\n  return Articles;\n}(Vue);\n\ntslib_1.__decorate([Watch(\"$route\")], Articles.prototype, \"routeChange\", null);\n\nArticles = tslib_1.__decorate([Component({\n  components: {\n    LoadEnd: LoadEnd,\n    LoadingCustom: LoadingCustom\n  }\n})], Articles);\nexport default Articles;",{"version":3,"sources":["E:\\WebStormProject\\blog-vue-typescript\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!E:\\WebStormProject\\blog-vue-typescript\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\WebStormProject\\blog-vue-typescript\\src\\views\\articles.vue?vue&type=script&lang=ts&"],"names":[],"mappings":"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","sourcesContent":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport { Component, Prop, Vue, Watch } from \"vue-property-decorator\";\r\nimport { Route } from \"vue-router\";\r\nimport {\r\n  throttle,\r\n  getScrollTop,\r\n  getDocumentHeight,\r\n  getWindowHeight,\r\n  getQueryStringByName,\r\n  timestampToTime\r\n} from \"@/utils/utils\";\r\nimport LoadEnd from \"@/components/loadEnd.vue\";\r\nimport LoadingCustom from \"@/components/loading.vue\";\r\nimport { ArticlesParams, ArticlesData } from \"@/types/index\";\r\n\r\n// 获取可视区域的高度\r\nconst viewHeight = window.innerHeight || document.documentElement.clientHeight;\r\n// 用新的 throttle 包装 scroll 的回调\r\nconst lazyload = throttle(() => {\r\n  // 获取所有的图片标签\r\n  const imgs = document.querySelectorAll(\"#list .item img\");\r\n  // num 用于统计当前显示到了哪一张图片，避免每次都从第一张图片开始检查是否露出\r\n  let num = 0;\r\n  for (let i = num; i < imgs.length; i++) {\r\n    // 用可视区域高度减去元素顶部距离可视区域顶部的高度\r\n    let distance = viewHeight - imgs[i].getBoundingClientRect().top;\r\n    let imgItem: any = imgs[i];\r\n    // 如果可视区域高度大于等于元素顶部距离可视区域顶部的高度，说明元素露出\r\n    if (distance >= 100) {\r\n      // 给元素写入真实的 src，展示图片\r\n      let hasLaySrc = imgItem.getAttribute(\"data-has-lazy-src\");\r\n      if (hasLaySrc === \"false\") {\r\n        imgItem.src = imgItem.getAttribute(\"data-src\");\r\n        imgItem.setAttribute(\"data-has-lazy-src\", \"true\");\r\n      }\r\n      // 前 i 张图片已经加载完毕，下次从第 i+1 张开始检查是否露出\r\n      num = i + 1;\r\n    }\r\n  }\r\n}, 1000);\r\n\r\n@Component({\r\n  components: {\r\n    LoadEnd,\r\n    LoadingCustom\r\n  }\r\n})\r\nexport default class Articles extends Vue {\r\n  // initial data\r\n  private isLoadEnd: boolean = false;\r\n  private isLoading: boolean = false;\r\n  private articlesList: Array<object> = [];\r\n  private total: number = 0;\r\n  private tag_name: string = decodeURI(getQueryStringByName(\"tag_name\"));\r\n  private params: ArticlesParams = {\r\n    keyword: \"\",\r\n    likes: \"\", // 是否是热门文章\r\n    state: 1, // 文章发布状态 => 0 草稿，1 已发布,'' 代表所有文章\r\n    tag_id: getQueryStringByName(\"tag_id\"),\r\n    category_id: getQueryStringByName(\"category_id\"),\r\n    pageNum: 1,\r\n    pageSize: 10\r\n  };\r\n  private href: string =\r\n    process.env.NODE_ENV === \"development\"\r\n      ? \"http://localhost:3001/articleDetail?article_id=\"\r\n      : \"https://biaochenxuying.cn/articleDetail?article_id=\";\r\n\r\n  // lifecycle hook\r\n  mounted(): void {\r\n    this.handleSearch();\r\n    window.onscroll = () => {\r\n      if (getScrollTop() + getWindowHeight() > getDocumentHeight() - 150) {\r\n        // 如果不是已经没有数据了，都可以继续滚动加载\r\n        if (this.isLoadEnd === false && this.isLoading === false) {\r\n          this.handleSearch();\r\n        }\r\n      }\r\n    };\r\n    document.addEventListener(\"scroll\", lazyload);\r\n  }\r\n\r\n  @Watch(\"$route\")\r\n  routeChange(val: Route, oldVal: Route): void {\r\n    this.tag_name = decodeURI(getQueryStringByName(\"tag_name\"));\r\n    this.params.tag_id = getQueryStringByName(\"tag_id\");\r\n    this.params.category_id = getQueryStringByName(\"category_id\");\r\n    this.articlesList = [];\r\n    this.params.pageNum = 1;\r\n    this.handleSearch();\r\n  }\r\n\r\n  // method\r\n  private articleDetail(id: string): void {\r\n    // console.log(\"`id`\", `/articleDetail?article_id=${id}`);\r\n    // let url: string = \"\";\r\n    // if (process.env.NODE_ENV === \"development\") {\r\n    //   url = \"http://localhost:3001/articleDetail?\";\r\n    // } else {\r\n    //   url = \"https://biaochenxuying.cn/articleDetail?\";\r\n    // }\r\n    // window.open(url + `article_id=${id}`);\r\n  }\r\n\r\n  private async handleSearch(): Promise<void> {\r\n    this.isLoading = true;\r\n    const data: ArticlesData = await this.$https.get(\r\n      //this.$urls.getArticleList,\r\n        '/articleList.json',\r\n      {\r\n        params: this.params\r\n      }\r\n    );\r\n    this.isLoading = false;\r\n    this.articlesList = [...this.articlesList, ...data.list];\r\n\r\n    this.total = data.count;\r\n    this.params.pageNum++;\r\n    this.$nextTick(() => {\r\n      lazyload();\r\n    });\r\n    if (data.list.length === 0 || this.total === this.articlesList.length) {\r\n      this.isLoadEnd = true;\r\n      document.removeEventListener(\"scroll\", () => {});\r\n      window.onscroll = null;\r\n    }\r\n  }\r\n}\r\n"],"sourceRoot":""}]}