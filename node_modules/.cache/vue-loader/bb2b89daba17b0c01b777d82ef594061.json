{"remainingRequest":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\WebStormProject\\blog-vue-typescript\\src\\components\\comment.vue?vue&type=script&lang=ts&","dependencies":[{"path":"E:\\WebStormProject\\blog-vue-typescript\\src\\components\\comment.vue","mtime":1573558720908},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\ts-loader\\index.js","mtime":1545640398000},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport { Component, Emit, Prop, Vue } from \"vue-property-decorator\";\r\nimport { Dialog, Form, FormItem, Input, Button, Message } from \"element-ui\";\r\nimport config from \"@/utils/config\";\r\nimport { ToUser } from \"@/types/index\";\r\n\r\n@Component({\r\n  components: {\r\n    Dialog,\r\n    Form,\r\n    FormItem,\r\n    Input,\r\n    Button\r\n  }\r\n})\r\nexport default class Comment extends Vue {\r\n  @Prop({ default: false }) visible!: boolean;\r\n  @Prop({ default: \"\" }) comment_id!: string;\r\n  @Prop({ default: \"\" }) article_id!: string;\r\n  @Prop({ default: {} }) to_user!: ToUser;\r\n\r\n  // initial data\r\n  private btnLoading: boolean = false;\r\n  private content: string = \"\";\r\n  private cacheTime: number = 0; // 缓存时间\r\n  private times: number = 0; // 留言次数\r\n\r\n  // computed\r\n  get dialogVisible(): boolean {\r\n    return this.visible;\r\n  }\r\n\r\n  // this.$emit\r\n  @Emit()\r\n  cancel() {}\r\n\r\n  @Emit(\"handleOk\")\r\n  private async handleOk(): Promise<void> {\r\n    if (!this.article_id) {\r\n      this.$message({\r\n        message: \"该文章不存在！\",\r\n        type: \"error\"\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (this.times > 2) {\r\n      this.$message({\r\n        message: \"您今天评论的次数已经用完，明天再来评论吧！\",\r\n        type: \"warning\"\r\n      });\r\n      return;\r\n    }\r\n\r\n    let now = new Date();\r\n    let nowTime = now.getTime();\r\n    if (nowTime - this.cacheTime < 4000) {\r\n      this.$message({\r\n        message: \"您评论太过频繁，1 分钟后再来评论吧！\",\r\n        type: \"warning\"\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (!this.content) {\r\n      this.$message({\r\n        message: \"评论内容不能为空\",\r\n        type: \"error\"\r\n      });\r\n      return;\r\n    }\r\n\r\n    let user_id = \"\";\r\n    if (window.sessionStorage.userInfo) {\r\n      let userInfo = JSON.parse(window.sessionStorage.userInfo);\r\n      user_id = userInfo._id;\r\n    } else {\r\n      this.$message({\r\n        message: \"登录才能评论，请先登录！\",\r\n        type: \"warning\"\r\n      });\r\n      return;\r\n    }\r\n    this.btnLoading = true;\r\n    await this.$https.post(this.$urls.addThirdComment, {\r\n      article_id: this.article_id,\r\n      user_id,\r\n      comment_id: this.comment_id,\r\n      to_user: JSON.stringify(this.to_user),\r\n      content: this.content\r\n    });\r\n    this.btnLoading = false;\r\n    this.times++;\r\n\r\n    this.cacheTime = nowTime;\r\n    this.content = \"\";\r\n    this.$message({\r\n      message: \"操作成功\",\r\n      type: \"success\"\r\n    });\r\n  }\r\n}\r\n",null]}