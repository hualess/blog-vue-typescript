{"remainingRequest":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\WebStormProject\\blog-vue-typescript\\src\\views\\articles.vue?vue&type=script&lang=ts&","dependencies":[{"path":"E:\\WebStormProject\\blog-vue-typescript\\src\\views\\articles.vue","mtime":1572859521995},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\ts-loader\\index.js","mtime":1545640398000},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport { Component, Prop, Vue, Watch } from \"vue-property-decorator\";\r\nimport { Route } from \"vue-router\";\r\nimport {\r\n  throttle,\r\n  getScrollTop,\r\n  getDocumentHeight,\r\n  getWindowHeight,\r\n  getQueryStringByName,\r\n  timestampToTime\r\n} from \"@/utils/utils\";\r\nimport LoadEnd from \"@/components/loadEnd.vue\";\r\nimport LoadingCustom from \"@/components/loading.vue\";\r\nimport { ArticlesParams, ArticlesData } from \"@/types/index\";\r\n\r\n// 获取可视区域的高度\r\nconst viewHeight = window.innerHeight || document.documentElement.clientHeight;\r\n// 用新的 throttle 包装 scroll 的回调\r\nconst lazyload = throttle(() => {\r\n  // 获取所有的图片标签\r\n  const imgs = document.querySelectorAll(\"#list .item img\");\r\n  // num 用于统计当前显示到了哪一张图片，避免每次都从第一张图片开始检查是否露出\r\n  let num = 0;\r\n  for (let i = num; i < imgs.length; i++) {\r\n    // 用可视区域高度减去元素顶部距离可视区域顶部的高度\r\n    let distance = viewHeight - imgs[i].getBoundingClientRect().top;\r\n    let imgItem: any = imgs[i];\r\n    // 如果可视区域高度大于等于元素顶部距离可视区域顶部的高度，说明元素露出\r\n    if (distance >= 100) {\r\n      // 给元素写入真实的 src，展示图片\r\n      let hasLaySrc = imgItem.getAttribute(\"data-has-lazy-src\");\r\n      if (hasLaySrc === \"false\") {\r\n        imgItem.src = imgItem.getAttribute(\"data-src\");\r\n        imgItem.setAttribute(\"data-has-lazy-src\", \"true\");\r\n      }\r\n      // 前 i 张图片已经加载完毕，下次从第 i+1 张开始检查是否露出\r\n      num = i + 1;\r\n    }\r\n  }\r\n}, 1000);\r\n\r\n@Component({\r\n  components: {\r\n    LoadEnd,\r\n    LoadingCustom\r\n  }\r\n})\r\nexport default class Articles extends Vue {\r\n  // initial data\r\n  private isLoadEnd: boolean = false;\r\n  private isLoading: boolean = false;\r\n  private articlesList: Array<object> = [];\r\n  private total: number = 0;\r\n  private tag_name: string = decodeURI(getQueryStringByName(\"tag_name\"));\r\n  private params: ArticlesParams = {\r\n    keyword: \"\",\r\n    likes: \"\", // 是否是热门文章\r\n    state: 1, // 文章发布状态 => 0 草稿，1 已发布,'' 代表所有文章\r\n    tag_id: getQueryStringByName(\"tag_id\"),\r\n    category_id: getQueryStringByName(\"category_id\"),\r\n    pageNum: 1,\r\n    pageSize: 10\r\n  };\r\n  private href: string =\r\n    process.env.NODE_ENV === \"development\"\r\n      ? \"http://localhost:3001/articleDetail?article_id=\"\r\n      : \"https://biaochenxuying.cn/articleDetail?article_id=\";\r\n\r\n  // lifecycle hook\r\n  mounted(): void {\r\n    this.handleSearch();\r\n    window.onscroll = () => {\r\n      if (getScrollTop() + getWindowHeight() > getDocumentHeight() - 150) {\r\n        // 如果不是已经没有数据了，都可以继续滚动加载\r\n        if (this.isLoadEnd === false && this.isLoading === false) {\r\n          this.handleSearch();\r\n        }\r\n      }\r\n    };\r\n    document.addEventListener(\"scroll\", lazyload);\r\n  }\r\n\r\n  @Watch(\"$route\")\r\n  routeChange(val: Route, oldVal: Route): void {\r\n    this.tag_name = decodeURI(getQueryStringByName(\"tag_name\"));\r\n    this.params.tag_id = getQueryStringByName(\"tag_id\");\r\n    this.params.category_id = getQueryStringByName(\"category_id\");\r\n    this.articlesList = [];\r\n    this.params.pageNum = 1;\r\n    this.handleSearch();\r\n  }\r\n\r\n  // method\r\n  private articleDetail(id: string): void {\r\n    // console.log(\"`id`\", `/articleDetail?article_id=${id}`);\r\n    // let url: string = \"\";\r\n    // if (process.env.NODE_ENV === \"development\") {\r\n    //   url = \"http://localhost:3001/articleDetail?\";\r\n    // } else {\r\n    //   url = \"https://biaochenxuying.cn/articleDetail?\";\r\n    // }\r\n    // window.open(url + `article_id=${id}`);\r\n  }\r\n\r\n  private async handleSearch(): Promise<void> {\r\n    this.isLoading = true;\r\n    const data: ArticlesData = await this.$https.get(\r\n      //this.$urls.getArticleList,\r\n        '/articleList.json',\r\n      {\r\n        params: this.params\r\n      }\r\n    );\r\n    this.isLoading = false;\r\n    this.articlesList = [...this.articlesList, ...data.list];\r\n\r\n    this.total = data.count;\r\n    this.params.pageNum++;\r\n    this.$nextTick(() => {\r\n      lazyload();\r\n    });\r\n    if (data.list.length === 0 || this.total === this.articlesList.length) {\r\n      this.isLoadEnd = true;\r\n      document.removeEventListener(\"scroll\", () => {});\r\n      window.onscroll = null;\r\n    }\r\n  }\r\n}\r\n",null]}