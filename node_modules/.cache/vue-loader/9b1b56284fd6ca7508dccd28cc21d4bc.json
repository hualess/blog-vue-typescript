{"remainingRequest":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\WebStormProject\\blog-vue-typescript\\src\\components\\nav.vue?vue&type=script&lang=ts&","dependencies":[{"path":"E:\\WebStormProject\\blog-vue-typescript\\src\\components\\nav.vue","mtime":1573632386328},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\ts-loader\\index.js","mtime":1545640398000},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport { Component, Vue, Watch } from \"vue-property-decorator\";\r\nimport RegisterAndLogin from \"@/components/registerAndLogin.vue\";\r\nimport { isMobileOrPc, getQueryStringByName } from \"@/utils/utils\";\r\nimport { Route } from \"vue-router\";\r\nimport { UserInfo, NavListItem } from \"@/types/index\";\r\n\r\n@Component({\r\n  components: {\r\n    RegisterAndLogin\r\n  }\r\n})\r\nexport default class Nav extends Vue {\r\n  private visible: boolean = false;\r\n  private handleFlag: string = \"\";\r\n  private title: string = \"首页\";\r\n  private list: Array<NavListItem> = [\r\n    {\r\n      index: \"1\",\r\n      path: \"/\",\r\n      name: \"首页\"\r\n    },\r\n    {\r\n      index: \"2\",\r\n      path: \"/articles\",\r\n      name: \"文章\"\r\n    },\r\n    {\r\n      index: \"3\",\r\n      path: \"/archive\",\r\n      name: \"归档\"\r\n    },\r\n    {\r\n      index: \"4\",\r\n      path: \"/project\",\r\n      name: \"项目\"\r\n    },\r\n    {\r\n      index: \"5\",\r\n      path: \"/timeline\",\r\n      name: \"历程\"\r\n    },\r\n    {\r\n      index: \"6\",\r\n      path: \"/message\",\r\n      name: \"留言\"\r\n    },\r\n    {\r\n      index: \"7\",\r\n      path: \"/about\",\r\n      name: \"关于\"\r\n    }\r\n  ];\r\n  private activeIndex: string = \"0\";\r\n  private enterSlideUp: boolean = false;\r\n  private leaveSlideDown: boolean = false;\r\n  private isShow: boolean = false;\r\n  private isMobile: boolean = isMobileOrPc();\r\n\r\n  mounted() {\r\n    // 授权登录的，有 code 参数\r\n    this.routeChange(this.$route, this.$route);\r\n    const code: string = getQueryStringByName(\"code\");\r\n    if (code) {\r\n      this.getUser(code);\r\n    }\r\n  }\r\n\r\n  get userInfo(): UserInfo {\r\n    let userInfo: UserInfo = {\r\n      _id: \"\",\r\n      name: \"\",\r\n      avatar: \"\"\r\n    };\r\n    if (window.sessionStorage.userInfo) {\r\n      userInfo = JSON.parse(window.sessionStorage.userInfo);\r\n      this.$store.commit(\"SAVE_USER\", {\r\n        userInfo\r\n      });\r\n    }\r\n    if (this.$store.state.user.userInfo) {\r\n      userInfo = this.$store.state.user.userInfo;\r\n    }\r\n    return userInfo;\r\n  }\r\n\r\n  @Watch(\"$route\")\r\n  routeChange(val: Route, oldVal: Route): void {\r\n    for (let i = 0; i < this.list.length; i++) {\r\n      const l: NavListItem = this.list[i];\r\n      if (l.path === val.path) {\r\n        this.activeIndex = i + 1 + \"\";\r\n        this.title = l.name;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  private handleClickMenu(route: string): void {\r\n    this.isShow = false;\r\n    if (route === \"/login\") {\r\n      this.handleFlag = \"login\";\r\n      this.visible = true;\r\n    }\r\n    if (route === \"/register\") {\r\n      this.handleFlag = \"register\";\r\n      this.visible = true;\r\n    }\r\n    if (route === \"/logout\") {\r\n      this.handleLogout();\r\n    }\r\n  }\r\n  private handleMenu(): void {\r\n    this.isShow = true;\r\n    this.enterSlideUp = true;\r\n  }\r\n  private handleHideMenu(): void {\r\n    this.enterSlideUp = false;\r\n    this.leaveSlideDown = true;\r\n    setTimeout(() => {\r\n      this.leaveSlideDown = false;\r\n      this.isShow = false;\r\n    }, 300);\r\n  }\r\n\r\n  private async getUser(code: string): Promise<void> {\r\n    const loading: any = this.$loading({\r\n      lock: true,\r\n      text: \"Loading\",\r\n      spinner: \"el-icon-loading\",\r\n      background: \"rgba(255, 255, 255, 0.7)\"\r\n    });\r\n    const data: UserInfo = await this.$https.post(\r\n      this.$urls.getUser,\r\n      { code },\r\n      { withCredentials: true }\r\n    );\r\n    loading.close();\r\n\r\n    const userInfo: UserInfo = {\r\n      _id: data._id,\r\n      name: data.name,\r\n      avatar: data.avatar\r\n    };\r\n    this.$store.commit(\"SAVE_USER\", {\r\n      userInfo\r\n    });\r\n    window.sessionStorage.userInfo = JSON.stringify(userInfo);\r\n    this.$message({\r\n      message: \"操作成功\",\r\n      type: \"success\"\r\n    });\r\n    let preventHistory = JSON.parse(window.sessionStorage.preventHistory);\r\n    if (preventHistory) {\r\n      this.$router.push({\r\n        path: preventHistory.name,\r\n        query: preventHistory.query\r\n      });\r\n    }\r\n  }\r\n\r\n  private handleLogout(): void {\r\n    window.sessionStorage.userInfo = \"\";\r\n    this.$store.commit(\"SAVE_USER\", {\r\n      userInfo: {\r\n        _id: \"\",\r\n        name: \"\",\r\n        avatar: \"\"\r\n      }\r\n    });\r\n  }\r\n\r\n  private handleClick(value: string): void {\r\n    this.handleFlag = value;\r\n    this.visible = true;\r\n  }\r\n\r\n  private handleCancel(value: boolean): void {\r\n    this.visible = value;\r\n  }\r\n  private handleOk(value: boolean): void {\r\n    this.visible = value;\r\n  }\r\n  private handleSelect(val: string, oldVal: string): void {\r\n    // console.log(\"val :\", val);\r\n    // console.log(\"oldVal :\", oldVal);\r\n    this.activeIndex = val;\r\n  }\r\n}\r\n",null]}