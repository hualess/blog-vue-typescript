{"remainingRequest":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\WebStormProject\\blog-vue-typescript\\src\\views\\articles.vue?vue&type=style&index=0&id=13b2a9d7&lang=less&scoped=true&","dependencies":[{"path":"E:\\WebStormProject\\blog-vue-typescript\\src\\views\\articles.vue","mtime":1572859521995},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\less-loader\\dist\\cjs.js","mtime":1573558749669},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n.left {\r\n  .articles-list {\r\n    margin: 0;\r\n    padding: 0;\r\n    list-style: none;\r\n    .title {\r\n      color: #333;\r\n      margin: 7px 0 4px;\r\n      display: inherit;\r\n      font-size: 18px;\r\n      font-weight: 700;\r\n      line-height: 1.5;\r\n    }\r\n    .item > div {\r\n      padding-right: 140px;\r\n    }\r\n    .item .wrap-img {\r\n      position: absolute;\r\n      top: 50%;\r\n      margin-top: -50px;\r\n      right: 0;\r\n      width: 125px;\r\n      height: 100px;\r\n      img {\r\n        width: 100%;\r\n        height: 100%;\r\n        border-radius: 4px;\r\n        border: 1px solid #f0f0f0;\r\n      }\r\n    }\r\n    li {\r\n      line-height: 20px;\r\n      position: relative;\r\n      // width: 100%;\r\n      padding: 15px 0px;\r\n      padding-right: 150px;\r\n      border-bottom: 1px solid #f0f0f0;\r\n      word-wrap: break-word;\r\n      cursor: pointer;\r\n      &:hover {\r\n        .title {\r\n          color: #000;\r\n        }\r\n      }\r\n      .abstract {\r\n        min-height: 30px;\r\n        margin: 0 0 8px;\r\n        font-size: 13px;\r\n        line-height: 24px;\r\n        color: #555;\r\n      }\r\n      .meta {\r\n        padding-right: 0 !important;\r\n        font-size: 12px;\r\n        font-weight: 400;\r\n        line-height: 20px;\r\n        a {\r\n          margin-right: 10px;\r\n          color: #b4b4b4;\r\n          &::hover {\r\n            transition: 0.1s ease-in;\r\n            -webkit-transition: 0.1s ease-in;\r\n            -moz-transition: 0.1s ease-in;\r\n            -o-transition: 0.1s ease-in;\r\n            -ms-transition: 0.1s ease-in;\r\n          }\r\n        }\r\n        span {\r\n          margin-right: 10px;\r\n          color: #666;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",{"version":3,"sources":["articles.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"articles.vue","sourceRoot":"src/views","sourcesContent":["<template>\r\n  <div class=\"left clearfix\">\r\n    <h3 v-if=\"params.tag_id\" class=\"left-title\">{{ tag_name }} 相关的文章：</h3>\r\n    <ul class=\"articles-list\" id=\"list\">\r\n      <transition-group name=\"el-fade-in\">\r\n        <li\r\n          @click=\"articleDetail(article._id)\"\r\n          v-for=\"article in articlesList\"\r\n          :key=\"article._id\"\r\n          class=\"item\"\r\n        >\r\n          <a :href=\"href + article._id\" target=\"_blank\">\r\n            <img\r\n              class=\"wrap-img img-blur-done\"\r\n              :data-src=\"article.img_url\"\r\n              data-has-lazy-src=\"false\"\r\n              src=\"../assets/bg.jpg\"\r\n              alt=\"文章封面\"\r\n            />\r\n            <div class=\"content\">\r\n              <h4 class=\"title\">{{ article.title }}</h4>\r\n              <p class=\"abstract\">{{ article.desc }}</p>\r\n              <div class=\"meta\">\r\n                <span>查看 {{ article.meta.views }}</span>\r\n                <span>评论 {{ article.meta.comments }}</span>\r\n                <span>赞 {{ article.meta.likes }}</span>\r\n                <span v-if=\"article.create_time\" class=\"time\">\r\n                  {{ formatTime(article.create_time) }}\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </a>\r\n        </li>\r\n      </transition-group>\r\n    </ul>\r\n    <LoadingCustom v-if=\"isLoading\"></LoadingCustom>\r\n    <LoadEnd v-if=\"isLoadEnd\"></LoadEnd>\r\n  </div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { Component, Prop, Vue, Watch } from \"vue-property-decorator\";\r\nimport { Route } from \"vue-router\";\r\nimport {\r\n  throttle,\r\n  getScrollTop,\r\n  getDocumentHeight,\r\n  getWindowHeight,\r\n  getQueryStringByName,\r\n  timestampToTime\r\n} from \"@/utils/utils\";\r\nimport LoadEnd from \"@/components/loadEnd.vue\";\r\nimport LoadingCustom from \"@/components/loading.vue\";\r\nimport { ArticlesParams, ArticlesData } from \"@/types/index\";\r\n\r\n// 获取可视区域的高度\r\nconst viewHeight = window.innerHeight || document.documentElement.clientHeight;\r\n// 用新的 throttle 包装 scroll 的回调\r\nconst lazyload = throttle(() => {\r\n  // 获取所有的图片标签\r\n  const imgs = document.querySelectorAll(\"#list .item img\");\r\n  // num 用于统计当前显示到了哪一张图片，避免每次都从第一张图片开始检查是否露出\r\n  let num = 0;\r\n  for (let i = num; i < imgs.length; i++) {\r\n    // 用可视区域高度减去元素顶部距离可视区域顶部的高度\r\n    let distance = viewHeight - imgs[i].getBoundingClientRect().top;\r\n    let imgItem: any = imgs[i];\r\n    // 如果可视区域高度大于等于元素顶部距离可视区域顶部的高度，说明元素露出\r\n    if (distance >= 100) {\r\n      // 给元素写入真实的 src，展示图片\r\n      let hasLaySrc = imgItem.getAttribute(\"data-has-lazy-src\");\r\n      if (hasLaySrc === \"false\") {\r\n        imgItem.src = imgItem.getAttribute(\"data-src\");\r\n        imgItem.setAttribute(\"data-has-lazy-src\", \"true\");\r\n      }\r\n      // 前 i 张图片已经加载完毕，下次从第 i+1 张开始检查是否露出\r\n      num = i + 1;\r\n    }\r\n  }\r\n}, 1000);\r\n\r\n@Component({\r\n  components: {\r\n    LoadEnd,\r\n    LoadingCustom\r\n  }\r\n})\r\nexport default class Articles extends Vue {\r\n  // initial data\r\n  private isLoadEnd: boolean = false;\r\n  private isLoading: boolean = false;\r\n  private articlesList: Array<object> = [];\r\n  private total: number = 0;\r\n  private tag_name: string = decodeURI(getQueryStringByName(\"tag_name\"));\r\n  private params: ArticlesParams = {\r\n    keyword: \"\",\r\n    likes: \"\", // 是否是热门文章\r\n    state: 1, // 文章发布状态 => 0 草稿，1 已发布,'' 代表所有文章\r\n    tag_id: getQueryStringByName(\"tag_id\"),\r\n    category_id: getQueryStringByName(\"category_id\"),\r\n    pageNum: 1,\r\n    pageSize: 10\r\n  };\r\n  private href: string =\r\n    process.env.NODE_ENV === \"development\"\r\n      ? \"http://localhost:3001/articleDetail?article_id=\"\r\n      : \"https://biaochenxuying.cn/articleDetail?article_id=\";\r\n\r\n  // lifecycle hook\r\n  mounted(): void {\r\n    this.handleSearch();\r\n    window.onscroll = () => {\r\n      if (getScrollTop() + getWindowHeight() > getDocumentHeight() - 150) {\r\n        // 如果不是已经没有数据了，都可以继续滚动加载\r\n        if (this.isLoadEnd === false && this.isLoading === false) {\r\n          this.handleSearch();\r\n        }\r\n      }\r\n    };\r\n    document.addEventListener(\"scroll\", lazyload);\r\n  }\r\n\r\n  @Watch(\"$route\")\r\n  routeChange(val: Route, oldVal: Route): void {\r\n    this.tag_name = decodeURI(getQueryStringByName(\"tag_name\"));\r\n    this.params.tag_id = getQueryStringByName(\"tag_id\");\r\n    this.params.category_id = getQueryStringByName(\"category_id\");\r\n    this.articlesList = [];\r\n    this.params.pageNum = 1;\r\n    this.handleSearch();\r\n  }\r\n\r\n  // method\r\n  private articleDetail(id: string): void {\r\n    // console.log(\"`id`\", `/articleDetail?article_id=${id}`);\r\n    // let url: string = \"\";\r\n    // if (process.env.NODE_ENV === \"development\") {\r\n    //   url = \"http://localhost:3001/articleDetail?\";\r\n    // } else {\r\n    //   url = \"https://biaochenxuying.cn/articleDetail?\";\r\n    // }\r\n    // window.open(url + `article_id=${id}`);\r\n  }\r\n\r\n  private async handleSearch(): Promise<void> {\r\n    this.isLoading = true;\r\n    const data: ArticlesData = await this.$https.get(\r\n      //this.$urls.getArticleList,\r\n        '/articleList.json',\r\n      {\r\n        params: this.params\r\n      }\r\n    );\r\n    this.isLoading = false;\r\n    this.articlesList = [...this.articlesList, ...data.list];\r\n\r\n    this.total = data.count;\r\n    this.params.pageNum++;\r\n    this.$nextTick(() => {\r\n      lazyload();\r\n    });\r\n    if (data.list.length === 0 || this.total === this.articlesList.length) {\r\n      this.isLoadEnd = true;\r\n      document.removeEventListener(\"scroll\", () => {});\r\n      window.onscroll = null;\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.left {\r\n  .articles-list {\r\n    margin: 0;\r\n    padding: 0;\r\n    list-style: none;\r\n    .title {\r\n      color: #333;\r\n      margin: 7px 0 4px;\r\n      display: inherit;\r\n      font-size: 18px;\r\n      font-weight: 700;\r\n      line-height: 1.5;\r\n    }\r\n    .item > div {\r\n      padding-right: 140px;\r\n    }\r\n    .item .wrap-img {\r\n      position: absolute;\r\n      top: 50%;\r\n      margin-top: -50px;\r\n      right: 0;\r\n      width: 125px;\r\n      height: 100px;\r\n      img {\r\n        width: 100%;\r\n        height: 100%;\r\n        border-radius: 4px;\r\n        border: 1px solid #f0f0f0;\r\n      }\r\n    }\r\n    li {\r\n      line-height: 20px;\r\n      position: relative;\r\n      // width: 100%;\r\n      padding: 15px 0px;\r\n      padding-right: 150px;\r\n      border-bottom: 1px solid #f0f0f0;\r\n      word-wrap: break-word;\r\n      cursor: pointer;\r\n      &:hover {\r\n        .title {\r\n          color: #000;\r\n        }\r\n      }\r\n      .abstract {\r\n        min-height: 30px;\r\n        margin: 0 0 8px;\r\n        font-size: 13px;\r\n        line-height: 24px;\r\n        color: #555;\r\n      }\r\n      .meta {\r\n        padding-right: 0 !important;\r\n        font-size: 12px;\r\n        font-weight: 400;\r\n        line-height: 20px;\r\n        a {\r\n          margin-right: 10px;\r\n          color: #b4b4b4;\r\n          &::hover {\r\n            transition: 0.1s ease-in;\r\n            -webkit-transition: 0.1s ease-in;\r\n            -moz-transition: 0.1s ease-in;\r\n            -o-transition: 0.1s ease-in;\r\n            -ms-transition: 0.1s ease-in;\r\n          }\r\n        }\r\n        span {\r\n          margin-right: 10px;\r\n          color: #666;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n"]}]}