{"remainingRequest":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\WebStormProject\\blog-vue-typescript\\src\\components\\registerAndLogin.vue?vue&type=script&lang=ts&","dependencies":[{"path":"E:\\WebStormProject\\blog-vue-typescript\\src\\components\\registerAndLogin.vue","mtime":1573558720910},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\ts-loader\\index.js","mtime":1545640398000},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\WebStormProject\\blog-vue-typescript\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport { Component, Emit, Prop, Vue } from \"vue-property-decorator\";\r\nimport config from \"@/utils/config\";\r\nimport { RegAndLogParams, UserInfo } from \"@/types/index\";\r\n\r\n@Component({\r\n  // components: {}\r\n})\r\nexport default class RegisterAndLogin extends Vue {\r\n  @Prop({ default: false }) visible!: boolean;\r\n  @Prop({ default: false }) handleFlag!: string;\r\n  @Prop({ default: false }) isMobile!: string;\r\n\r\n  // initial data\r\n  private btnLoading: boolean = false;\r\n  private loading: boolean = false;\r\n  private formLabelWidth: string = this.isMobile ? \"40px\" : \"60px\";\r\n  private params: RegAndLogParams = {\r\n    email: \"\",\r\n    name: \"\",\r\n    password: \"\",\r\n    phone: \"\",\r\n    desc: \"\"\r\n  };\r\n\r\n  // lifecycle hook\r\n  mounted() {}\r\n\r\n  // computed\r\n  get dialogVisible(): boolean {\r\n    return this.visible;\r\n  }\r\n\r\n  // method\r\n  private handleOAuth(): void {\r\n    // 保存授权前的页面链接内容\r\n    let preventHistory: object = {\r\n      name: this.$route.name,\r\n      query: this.$route.query\r\n    };\r\n    window.sessionStorage.preventHistory = JSON.stringify(preventHistory);\r\n    // window.location.href = 'https://github.com/login/oauth/authorize?client_id=6de90ab270aea2bdb01c&redirect_uri=http://biaochenxuying.cn/login'\r\n    window.location.href = `${config.oauth_uri}?client_id=${config.client_id}&redirect_uri=${config.redirect_uri}`;\r\n  }\r\n\r\n  private handleOk(): void {\r\n    const reg = new RegExp(\r\n      \"^[a-z0-9]+([._\\\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$\"\r\n    ); //正则表达式\r\n    if (!this.params.email) {\r\n      // Message.warning(\"邮箱不能为空！\");\r\n      this.$message({\r\n        message: \"邮箱不能为空！\",\r\n        type: \"warning\"\r\n      });\r\n      return;\r\n    } else if (!reg.test(this.params.email)) {\r\n      this.$message({\r\n        message: \"请输入格式正确的邮箱！\",\r\n        type: \"warning\"\r\n      });\r\n      return;\r\n    }\r\n    if (this.handleFlag === \"register\") {\r\n      if (!this.params.password) {\r\n        this.$message({\r\n          message: \"密码不能为空！\",\r\n          type: \"warning\"\r\n        });\r\n        return;\r\n      } else if (!this.params.name) {\r\n        this.$message({\r\n          message: \"用户名不能为空！\",\r\n          type: \"warning\"\r\n        });\r\n        return;\r\n      }\r\n      const re = /^(((13[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\\d{8})$/;\r\n      if (this.params.phone && !re.test(this.params.phone)) {\r\n        this.$message({\r\n          message: \"请输入正确的手机号!\",\r\n          type: \"warning\"\r\n        });\r\n        return;\r\n      }\r\n    }\r\n    this.submit();\r\n  }\r\n\r\n  // this.$emit\r\n  @Emit()\r\n  private cancel(): boolean {\r\n    return false;\r\n  }\r\n  @Emit(\"ok\")\r\n  private async submit(): Promise<void> {\r\n    let data: any = \"\";\r\n    this.btnLoading = true;\r\n    if (this.handleFlag === \"register\") {\r\n      data = await this.$https.post(this.$urls.register, this.params);\r\n    } else {\r\n      data = await this.$https.post(this.$urls.login, this.params);\r\n    }\r\n    this.btnLoading = false;\r\n\r\n    const userInfo: UserInfo = {\r\n      _id: data._id,\r\n      name: data.name,\r\n      avatar: data.avatar\r\n    };\r\n    this.$store.commit(\"SAVE_USER\", {\r\n      userInfo\r\n    });\r\n    window.sessionStorage.userInfo = JSON.stringify(userInfo);\r\n    this.$message({\r\n      message: \"操作成功\",\r\n      type: \"success\"\r\n    });\r\n  }\r\n}\r\n",{"version":3,"sources":["registerAndLogin.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2DA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"registerAndLogin.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <el-dialog title=\"登录\"\r\n             :width=\"isMobile ? '90%' : '50%'\"\r\n             :visible=\"dialogVisible\"\r\n             @close=\"cancel\">\r\n    <el-form>\r\n      <el-formItem label=\"邮箱\"\r\n                   :label-width=\"formLabelWidth\">\r\n        <el-input v-model=\"params.email\"\r\n                  placeholder=\"邮箱\"\r\n                  autocomplete=\"off\">\r\n        </el-input>\r\n      </el-formItem>\r\n      <el-formItem label=\"密码\"\r\n                   :label-width=\"formLabelWidth\">\r\n        <el-input type=\"password\"\r\n                  placeholder=\"密码\"\r\n                  v-model=\"params.password\"\r\n                  autocomplete=\"off\"></el-input>\r\n      </el-formItem>\r\n      <el-formItem v-if=\"handleFlag === 'register'\"\r\n                   label=\"昵称\"\r\n                   :label-width=\"formLabelWidth\">\r\n        <el-input v-model=\"params.name\"\r\n                  placeholder=\"用户名或昵称\"\r\n                  autocomplete=\"off\"></el-input>\r\n      </el-formItem>\r\n      <el-formItem v-if=\"handleFlag === 'register'\"\r\n                   label=\"手机\"\r\n                   :label-width=\"formLabelWidth\">\r\n        <el-input v-model=\"params.phone\"\r\n                  placeholder=\"手机号\"\r\n                  autocomplete=\"off\"></el-input>\r\n      </el-formItem>\r\n      <el-formItem v-if=\"handleFlag === 'register'\"\r\n                   label=\"简介\"\r\n                   :label-width=\"formLabelWidth\">\r\n        <el-input v-model=\"params.desc\"\r\n                  placeholder=\"个人简介\"\r\n                  autocomplete=\"off\"></el-input>\r\n      </el-formItem>\r\n    </el-form>\r\n    <div slot=\"footer\"\r\n         class=\"dialog-footer\">\r\n      <el-button type=\"success\"\r\n                 @click=\"handleOAuth\">github 授权登录</el-button>\r\n      <el-button v-if=\"handleFlag === 'login'\"\r\n                 :loading=\"btnLoading\"\r\n                 type=\"primary\"\r\n                 @click=\"handleOk('login')\">登 录</el-button>\r\n      <el-button v-if=\"handleFlag === 'register'\"\r\n                 :loading=\"btnLoading\"\r\n                 type=\"primary\"\r\n                 @click=\"handleOk('register')\">注 册</el-button>\r\n    </div>\r\n  </el-dialog>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { Component, Emit, Prop, Vue } from \"vue-property-decorator\";\r\nimport config from \"@/utils/config\";\r\nimport { RegAndLogParams, UserInfo } from \"@/types/index\";\r\n\r\n@Component({\r\n  // components: {}\r\n})\r\nexport default class RegisterAndLogin extends Vue {\r\n  @Prop({ default: false }) visible!: boolean;\r\n  @Prop({ default: false }) handleFlag!: string;\r\n  @Prop({ default: false }) isMobile!: string;\r\n\r\n  // initial data\r\n  private btnLoading: boolean = false;\r\n  private loading: boolean = false;\r\n  private formLabelWidth: string = this.isMobile ? \"40px\" : \"60px\";\r\n  private params: RegAndLogParams = {\r\n    email: \"\",\r\n    name: \"\",\r\n    password: \"\",\r\n    phone: \"\",\r\n    desc: \"\"\r\n  };\r\n\r\n  // lifecycle hook\r\n  mounted() {}\r\n\r\n  // computed\r\n  get dialogVisible(): boolean {\r\n    return this.visible;\r\n  }\r\n\r\n  // method\r\n  private handleOAuth(): void {\r\n    // 保存授权前的页面链接内容\r\n    let preventHistory: object = {\r\n      name: this.$route.name,\r\n      query: this.$route.query\r\n    };\r\n    window.sessionStorage.preventHistory = JSON.stringify(preventHistory);\r\n    // window.location.href = 'https://github.com/login/oauth/authorize?client_id=6de90ab270aea2bdb01c&redirect_uri=http://biaochenxuying.cn/login'\r\n    window.location.href = `${config.oauth_uri}?client_id=${config.client_id}&redirect_uri=${config.redirect_uri}`;\r\n  }\r\n\r\n  private handleOk(): void {\r\n    const reg = new RegExp(\r\n      \"^[a-z0-9]+([._\\\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$\"\r\n    ); //正则表达式\r\n    if (!this.params.email) {\r\n      // Message.warning(\"邮箱不能为空！\");\r\n      this.$message({\r\n        message: \"邮箱不能为空！\",\r\n        type: \"warning\"\r\n      });\r\n      return;\r\n    } else if (!reg.test(this.params.email)) {\r\n      this.$message({\r\n        message: \"请输入格式正确的邮箱！\",\r\n        type: \"warning\"\r\n      });\r\n      return;\r\n    }\r\n    if (this.handleFlag === \"register\") {\r\n      if (!this.params.password) {\r\n        this.$message({\r\n          message: \"密码不能为空！\",\r\n          type: \"warning\"\r\n        });\r\n        return;\r\n      } else if (!this.params.name) {\r\n        this.$message({\r\n          message: \"用户名不能为空！\",\r\n          type: \"warning\"\r\n        });\r\n        return;\r\n      }\r\n      const re = /^(((13[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\\d{8})$/;\r\n      if (this.params.phone && !re.test(this.params.phone)) {\r\n        this.$message({\r\n          message: \"请输入正确的手机号!\",\r\n          type: \"warning\"\r\n        });\r\n        return;\r\n      }\r\n    }\r\n    this.submit();\r\n  }\r\n\r\n  // this.$emit\r\n  @Emit()\r\n  private cancel(): boolean {\r\n    return false;\r\n  }\r\n  @Emit(\"ok\")\r\n  private async submit(): Promise<void> {\r\n    let data: any = \"\";\r\n    this.btnLoading = true;\r\n    if (this.handleFlag === \"register\") {\r\n      data = await this.$https.post(this.$urls.register, this.params);\r\n    } else {\r\n      data = await this.$https.post(this.$urls.login, this.params);\r\n    }\r\n    this.btnLoading = false;\r\n\r\n    const userInfo: UserInfo = {\r\n      _id: data._id,\r\n      name: data.name,\r\n      avatar: data.avatar\r\n    };\r\n    this.$store.commit(\"SAVE_USER\", {\r\n      userInfo\r\n    });\r\n    window.sessionStorage.userInfo = JSON.stringify(userInfo);\r\n    this.$message({\r\n      message: \"操作成功\",\r\n      type: \"success\"\r\n    });\r\n  }\r\n}\r\n</script>"]}]}